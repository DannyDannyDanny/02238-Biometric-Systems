# Face Quality Enhancement (FQE)
> 02238-Biometric-Systems

## Open-CV
>See [this comment](https://github.com/pypa/pipenv/issues/1313#issuecomment-358188962) if installing with pipenv

## Approach
1. Download hi-res face
2. Resample at lower-resolutions

## Introduction
The scope of this project report is:
* Analysis of a set of face enhancements and their influence on comparison scores
* Graphs showing the effect of various enhancements on the biometric performance

## Preliminary Investigation
A preliminary investigation on the overall impact of sample quality on detection ability is tested by applying OpenCV feature detection to a live camera stream.

The 720p front-facing camera of a laptop revealed that even when the subject is centered and consumes a majority portion of the screen, OpenCV feature detection quality depends primarily on direct or neutral lighting and prefers a frontal-full-face at camera level with no forward/backward and side-to-side tilt.

In the case of a security camera watching over a stream of pedestrians, a subject may have an easily detectable head posture in good lighting for a single frame or two.

This report will investigate to what extent lighting, face angle and distance (simulated through resampling) affect image quality.

#Data
>The MIT-CBCL face recognition database contains face images of 10 subjects. It provides two training sets: 1. High resolution pictures, including frontal, half-profile and profile view; 2. Synthetic images (324/subject) rendered from 3D head models of the 10 subjects. The head models were generated by fitting a morphable model to the high-resolution training images. The 3D models are not included in the database. The test set consists of 200 images per subject. We varied the illumination, pose (up to about 30 degrees of rotation in depth) and the background. [Link to page](http://cbcl.mit.edu/software-datasets/heisele/facerecognition-database.html)

### Filtering OpenCV Cascades

Scanning the 3240 images yields the following OpenCV cascades as the top performers:
* 2928:haarcascade_frontalface_alt.xml
* 3221:haarcascade_frontalface_alt2.xml
* 2887:haarcascade_frontalface_default.xml
* 1813:haarcascade_profileface.xml

Several feature cascades are omitted due to irregular performance:
* *haarcascade_smile* yields high false negative rates occasionally misclassifying a thin eyebrow as a smile
* *lefteye_2splits* and *righteye_2splits* are asymmetric features and underperform on slightly side-facing images or uneven lighting.

### Filtering Facial images
Due to the synthesized nature of the images in the database, some faces look unnatural and some even show signs of digital aliasing. Faces which OpenCV struggles with due to bad synthesis or excessively skewed views, are removed from the analysis.
* 0002_-32_0_0_75_0_1.pgm
* 0009_0_0_0_0_75_45_1.pgm
* 0008_-32_0_0_0_90_30_1.pgm
* 0006_-32_0_0_0_75_0_1.pgm

## Downsampling and optimizing
...

## Method
### Haar Cascades
The `cv2` library performs face detection. The process involves analyzing differences between neighboring regions of in an image, to find certain features. The features may vary in complexity from diagonal and vertical edges to human faces and number plates.

The features are detected using *Haar feature-based Cascade Classifiers* which are specially pre-trained to specific features using machine learning and large sets of images. [More on that here.](https://docs.opencv.org/3.4.1/d7/d8b/tutorial_py_face_detection.html)


#### OpenCV and Haar Cascades
The OpenCV library contains a range of Haar cascades ranging for detecting features like Russian license plates, Cat faces and sub-features of human faces. For the data set used in this analysis the best performing cascade is *haarcascade_frontalface_default.xml*


### Identification / Recognition
Identification: *"Yes, that is a face"*
Recognition: *"Yes, that is Jim's face"*


## Data1
The data set is a directory containing faces taken between April 1992 and April 1994 at the Olivetti Research Laboratory in Cambridge, UK.

There are 10 different images of 40 distinct subjects. For some of the subjects, the images were taken at different times, varying lighting slightly, facial expressions (open/closed eyes, smiling/non-smiling) and facial details (glasses/no-glasses).  All the images are taken against a dark homogeneous background and the subjects are in up-right, frontal position (with tolerance for some side movement).

The files are in PGM format and can be conveniently viewed using the 'xv' program. The size of each image is 92x112, 8-bit grey levels.

----
AT&T "The Database of Faces" (formerly "The ORL Database of Faces")

Ten different images of each of 40 distinct subjects. For some subjects, the images were taken at different times, varying the lighting, facial expressions (open / closed eyes, smiling / not smiling) and facial details (glasses / no glasses). All the images were taken against a dark homogeneous background with the subjects in an upright, frontal position (with tolerance for some side movement).
----

The fact that the pics are grey is irrelevant due to the fact that OpenCV only takes greyscale images as input.

## Future Work
Training models on diagonal as well as downward tilted faces.


## Optimization
https://medium.com/machine-learning-world/how-to-replicate-lets-enhance-service-without-even-coding-3b6b31b0fa2e

## Bibliography

#### OpenCV
Object Detection using Haar feature-based cascade classifiers is an effective object detection method proposed by Paul Viola and Michael Jones in their paper, "Rapid Object Detection using a Boosted Cascade of Simple Features" in 2001.

#### Pics
[LINK](http://www.cl.cam.ac.uk/research/dtg/attarchive/facedatabase.html)
A convenient reference is the face recognition work which uses some of
these images:
F. Samaria and A. Harter
"Parameterisation of a stochastic model for human face identification"
2nd IEEE Workshop on Applications of Computer Vision
December 1994, Sarasota (Florida).
When using these images, please give credit to Olivetti Research Laboratory.
